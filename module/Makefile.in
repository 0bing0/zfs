subdir-m += avl
subdir-m += nvpair
subdir-m += unicode
subdir-m += zcommon
subdir-m += zfs

modules clean:
	# Make the exported SPL symbols available to these modules.
	cp @splsymvers@ .
	$(MAKE) -C @LINUX@ SUBDIRS=`pwd` @KERNELMAKE_PARAMS@ $@

modules_install:
	$(MAKE) -C @LINUX@ SUBDIRS=`pwd` INSTALL_MOD_PATH=$(DESTDIR) INSTALL_MOD_DIR=addon $@
	# Install the required headers in to the kernel source
	(mkdir -p $(DESTDIR)/@LINUX@/include/zfs && \
	 find . -mindepth 3 -maxdepth 3 -name '*.h' | \
	 xargs cp -t $(DESTDIR)/@LINUX@/include/zfs) || exit 1; \
	(mkdir -p $(DESTDIR)/@LINUX@/include/zfs/sys && \
	 find . -mindepth 4 -maxdepth 4 -name '*.h' | \
	 xargs cp -t $(DESTDIR)/@LINUX@/include/zfs/sys) || exit 1;

distdir:
	distfiles=`find . -name '*.c' -o -name '*.h'`; \
	for distfile in $$distfiles; do \
		distpath=`dirname $$distdir/$$distfile`; \
		(/bin/mkdir -p $$distpath && \
		 /bin/cp $$distfile $$distdir/$$distfile) || exit 1; \
	done

distclean maintainer-clean: clean
install: modules_install
all: modules
check:
