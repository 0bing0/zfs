subdir-m += include
DISTFILES  = kernel.c mkdirp.c strlcpy.c taskq.c util.c
DISTFILES += list.c strlcat.c strnlen.c u8_textprep.c

LIBRARY := libspl

# Compile as shared library.  There's an extra useless host program
# here called 'zu' because it was the easiest way I could convince
# the kernel build system to construct a user space shared library.

HOSTCFLAGS += @HOSTCFLAGS@
HOSTCFLAGS += -I@LIBDIR@/libumem/include
HOSTCFLAGS += -I@LIBDIR@/libspl/include

HOSTLDFLAGS += -lumem -L@LIBDIR@/libumem

# Additional shared library paths for executing binaries in-tree
export LD_RUN_PATH = @LIBDIR@/libumem

hostprogs-y := zu
always := $(hostprogs-y)

zu-objs := zu.o ${LIBRARY}.so

${LIBRARY}-objs += kernel.o
${LIBRARY}-objs += mkdirp.o
${LIBRARY}-objs += strlcpy.o
${LIBRARY}-objs += taskq.o
${LIBRARY}-objs += util.o
${LIBRARY}-objs += list.o
${LIBRARY}-objs += strlcat.o
${LIBRARY}-objs += strnlen.o
${LIBRARY}-objs += u8_textprep.o
