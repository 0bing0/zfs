subdir-m += include
DISTFILES  = envvar.c getpcstack.c init_lib.c init_stand.c linktest_stand.c
DISTFILES += malloc.c misc.c stub_stand.c umem.c umem_agent_support.c
DISTFILES += umem_fail.c umem_fork.c umem_update_thread.c vmem.c
DISTFILES += vmem_base.c vmem_mmap.c vmem_sbrk.c vmem_stand.c zu.c

LIBRARY := libumem

# Compile as shared library.  There's an extra useless host program
# here called 'zu' because it was the easiest way I could convince
# the kernel build system to construct a user space shared library.

HOSTCFLAGS += @HOSTCFLAGS@
HOSTCFLAGS += -I@LIBDIR@/libumem/include

HOSTLDFLAGS += -pthread
HOSTLDFLAGS += -ldl

hostprogs-y := zu
always := $(hostprogs-y)

zu-objs := zu.o ${LIBRARY}.so

${LIBRARY}-objs += envvar.o
${LIBRARY}-objs += getpcstack.o
${LIBRARY}-objs += init_lib.o
${LIBRARY}-objs += misc.o
${LIBRARY}-objs += umem.o
${LIBRARY}-objs += umem_agent_support.o
${LIBRARY}-objs += umem_fail.o
${LIBRARY}-objs += umem_fork.o
${LIBRARY}-objs += umem_update_thread.o
${LIBRARY}-objs += vmem.o
${LIBRARY}-objs += vmem_base.o
${LIBRARY}-objs += vmem_mmap.o
${LIBRARY}-objs += vmem_sbrk.o

# Currently unused
# ${LIBRARY}-objs += init_stand.o
# ${LIBRARY}-objs += linktest_stand.o
# ${LIBRARY}-objs += malloc.o
# ${LIBRARY}-objs += stub_stand.o
# ${LIBRARY}-objs += vmem_stand.o
